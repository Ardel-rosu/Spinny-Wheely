<!DOCTYPE html>
<html>
<head>
    <title>Spinny Wheely</title>
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e293b;
            --accent: #38bdf8;
        }
        body { font-family: 'Inter', system-ui, sans-serif; display: flex; flex-direction: column; align-items: center; background: var(--bg); color: white; padding: 20px; min-height: 100vh; }
        
        /* The Site Title */
        #theme-display { font-size: 2.5em; margin-bottom: 10px; border: none; background: transparent; text-align: center; color: var(--accent); font-weight: 800; width: 100%; outline: none; }
        
        #canvas-container { position: relative; margin: 30px; filter: drop-shadow(0 0 20px rgba(0,0,0,0.5)); }
        canvas { border-radius: 50%; border: 12px solid #334155; }
        #pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 45px solid #ef4444; z-index: 10; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); }
        
        .controls { background: var(--card); padding: 25px; border-radius: 20px; width: 450px; display: flex; flex-direction: column; gap: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        textarea { width: 100%; height: 120px; background: #0f172a; border: 1px solid #334155; color: #cbd5e1; padding: 12px; border-radius: 10px; resize: none; font-family: monospace; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button { padding: 14px; border: none; border-radius: 10px; color: white; font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .btn-spin { background: linear-gradient(135deg, #22c55e, #16a34a); grid-column: span 2; font-size: 1.3em; text-transform: uppercase; letter-spacing: 1px; }
        .btn-spin:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }
        .btn-util { background: #475569; }
        .btn-reset { background: #64748b; }
        
        #result { margin-top: 25px; font-size: 1.5em; text-align: center; height: 60px; color: #facc15; }
        .remaining-count { font-size: 0.9em; color: #94a3b8; margin-bottom: 5px; }
    </style>
</head>
<body>

    <input type="text" id="theme-display" value="Spinny Wheely" placeholder="TITLE OF WHEEL" oninput="saveData()">
    <div class="remaining-count" id="count-display">Remaining: 0</div>

    <div id="canvas-container">
        <div id="pointer"></div>
        <canvas id="wheel" width="500" height="500"></canvas>
    </div>

    <div class="controls">
        <textarea id="list" placeholder="Name, URL (One per line)" oninput="resetElimination()">Google, https://google.com
YouTube, https://youtube.com</textarea>
        
        <button id="spinBtn" class="btn-spin" onclick="spin()">Spin the Wheel</button>
        
        <div class="btn-group">
            <button class="btn-reset" onclick="resetElimination()">ðŸ”„ Reset List</button>
            <button class="btn-util" onclick="exportData()">ðŸ“¤ Export JSON</button>
            <button class="btn-util" style="grid-column: span 2;" onclick="importData()">ðŸ“¥ Import JSON File</button>
        </div>
    </div>

    <div id="result"></div>

    <script>
        const canvas = document.getElementById('wheel');
        const ctx = canvas.getContext('2d');
        const listInput = document.getElementById('list');
        const themeInput = document.getElementById('theme-display');
        const resultDiv = document.getElementById('result');
        const spinBtn = document.getElementById('spinBtn');

        let currentRotation = 0;
        let isSpinning = false;
        let eliminatedIndices = new Set();

        const COLORS = [
            "#f43f5e", "#8b5cf6", "#3b82f6", "#06b6d4", "#10b981", "#f59e0b", 
            "#ec4899", "#6366f1", "#0ea5e9", "#14b8a6", "#84cc16", "#f97316",
            "#4ade80", "#fb7185", "#38bdf8", "#fbbf24", "#a78bfa", "#2dd4bf"
        ];

        function saveData() {
            localStorage.setItem('wheelData', JSON.stringify({
                theme: themeInput.value,
                entries: listInput.value
            }));
        }

        function loadData() {
            const saved = localStorage.getItem('wheelData');
            if (saved) {
                const data = JSON.parse(saved);
                themeInput.value = data.theme || "Spinny Wheely";
                listInput.value = data.entries || "Google, https://google.com\nYouTube, https://youtube.com";
            }
            drawWheel();
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = ".json";
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = readerEvent => {
                    try {
                        const content = JSON.parse(readerEvent.target.result);
                        if(confirm("Overwrite current wheel?")) {
                            themeInput.value = content.theme || "Spinny Wheely";
                            listInput.value = content.entries || "";
                            resetElimination();
                        }
                    } catch (err) {
                        alert("Invalid file.");
                    }
                }
                reader.readAsText(file);
            }
            input.click();
        }

        function exportData() {
            const data = { theme: themeInput.value, entries: listInput.value };
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = (themeInput.value.replace(/\s+/g, '-').toLowerCase() || 'spinny-wheely') + '.json';
            a.click();
        }

        function getFullList() {
            return listInput.value.split('\n')
                .map(line => {
                    const parts = line.split(',');
                    return { name: parts[0]?.trim(), url: parts.slice(1).join(',').trim() };
                }).filter(e => e.name);
        }

        function getAvailableEntries() {
            const all = getFullList();
            return all.filter((_, index) => !eliminatedIndices.has(index));
        }

        function drawWheel() {
            const entries = getAvailableEntries();
            document.getElementById('count-display').innerText = `Remaining: ${entries.length}`;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (entries.length === 0) {
                ctx.fillStyle = "#94a3b8";
                ctx.font = "bold 20px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("EMPTY - CLICK RESET", 250, 250);
                spinBtn.disabled = true;
                return;
            }
            spinBtn.disabled = false;

            const arc = (2 * Math.PI) / entries.length;

            entries.forEach((entry, i) => {
                const angle = currentRotation + (i * arc);
                ctx.beginPath();
                ctx.fillStyle = COLORS[i % COLORS.length];
                ctx.moveTo(250, 250);
                ctx.arc(250, 250, 250, angle, angle + arc);
                ctx.fill();
                ctx.strokeStyle = "rgba(0,0,0,0.15)";
                ctx.stroke();

                ctx.save();
                ctx.translate(250, 250);
                ctx.rotate(angle + arc / 2);
                ctx.fillStyle = "white";
                ctx.font = "bold 14px sans-serif";
                ctx.shadowColor = "black";
                ctx.shadowBlur = 3;
                ctx.fillText(entry.name.substring(0, 18), 80, 5);
                ctx.restore();
            });
        }

        function spin() {
            if (isSpinning) return;
            const entries = getAvailableEntries();
            if (entries.length === 0) return;

            isSpinning = true;
            resultDiv.innerHTML = "Spinning...";

            const extraSpins = (Math.random() * 5 + 5) * 2 * Math.PI; 
            const finalRotation = currentRotation + extraSpins;
            const startTime = performance.now();
            const duration = 4000;

            function animate(now) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 4);
                
                currentRotation = finalRotation * easeOut;
                drawWheel();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    finalizeWin();
                }
            }
            requestAnimationFrame(animate);
        }

        function finalizeWin() {
            const entries = getAvailableEntries();
            const arc = (2 * Math.PI) / entries.length;
            const normalized = (currentRotation % (2 * Math.PI));
            const pointerAngle = (1.5 * Math.PI); 
            
            let winningIndexInAvailable = Math.floor((pointerAngle - normalized) / arc) % entries.length;
            if (winningIndexInAvailable < 0) winningIndexInAvailable += entries.length;

            const winner = entries[winningIndexInAvailable];
            
            const fullList = getFullList();
            const originalIndex = fullList.findIndex(e => e.name === winner.name && e.url === winner.url);
            eliminatedIndices.add(originalIndex);

            const linkStr = winner.url ? `<br><a href="${winner.url}" target="_blank" style="color: #38bdf8;">VISIT LINK</a>` : '';
            resultDiv.innerHTML = `ðŸŽ‰ WON: ${winner.name} ${linkStr}`;
            
            drawWheel();
        }

        function resetElimination() {
            eliminatedIndices.clear();
            saveData();
            drawWheel();
            resultDiv.innerHTML = "";
        }

        window.onload = loadData;
    </script>
</body>
</html>